{% extends 'base.html' %}
{% load static %}

{% block title %}Timeline - Bit√°cora{% endblock %}

{% block extra_css %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
    
    * {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    
    body {
        background: #fafafa;
    }
    
    .hero-section {
        background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        color: white;
        padding: 3rem 0;
        margin: -2rem -2rem 2rem -2rem;
        position: relative;
        overflow: hidden;
    }
    
    .hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.15) 0%, transparent 50%);
    }
    
    .hero-content {
        position: relative;
        z-index: 1;
    }
    
    .hero-title {
        font-size: 2.5rem;
        font-weight: 900;
        margin-bottom: 0.5rem;
        letter-spacing: -0.02em;
    }
    
    .hero-subtitle {
        font-size: 1.125rem;
        opacity: 0.8;
    }
    
    .filters-section {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        align-items: center;
    }
    
    .timeline-container {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
        overflow-x: auto;
    }
    
    .timeline-project {
        margin-bottom: 3rem;
    }
    
    .project-header {
        font-size: 1.5rem;
        font-weight: 700;
        color: #111827;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid #6366f1;
    }
    
    .timeline-track {
        position: relative;
        margin-bottom: 2rem;
        padding: 1rem;
        background: #f9fafb;
        border-radius: 8px;
    }
    
    .timeline-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .timeline-label {
        min-width: 200px;
        font-weight: 600;
        color: #374151;
    }
    
    .timeline-bar-container {
        flex: 1;
        position: relative;
        height: 40px;
        background: #e5e7eb;
        border-radius: 4px;
        overflow: hidden;
    }
    
    .timeline-bar {
        height: 100%;
        border-radius: 4px;
        display: flex;
        align-items: center;
        padding: 0 0.75rem;
        color: white;
        font-weight: 600;
        font-size: 0.875rem;
        transition: all 0.2s;
        cursor: pointer;
    }
    
    .timeline-bar:hover {
        opacity: 0.9;
        transform: scaleY(1.1);
    }
    
    .timeline-bar.programada {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .timeline-bar.en_progreso {
        background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
    }
    
    .timeline-bar.completada {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    }
    
    .timeline-bar.cancelada {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    }
</style>
{% endblock %}

{% block content %}
<div class="hero-section">
    <div class="container hero-content">
        <h1 class="hero-title">
            <i class="fas fa-project-diagram me-3"></i>Timeline de Planificaciones
        </h1>
        <p class="hero-subtitle">Visualiza el cronograma de actividades por proyecto</p>
    </div>
</div>

<div class="container">
    <div class="filters-section">
        <div>
            <label style="font-size: 0.875rem; font-weight: 600; color: #374151; margin-right: 0.5rem;">Proyecto:</label>
            <select id="filter_proyecto" class="filter-select" onchange="aplicarFiltros()">
                <option value="">Todos los proyectos</option>
                {% for proyecto in proyectos %}
                    <option value="{{ proyecto.id }}" {% if proyecto_seleccionado == proyecto.id|stringformat:"s" %}selected{% endif %}>
                        {{ proyecto.nombre }}
                    </option>
                {% endfor %}
            </select>
        </div>
        
        <div>
            <label style="font-size: 0.875rem; font-weight: 600; color: #374151; margin-right: 0.5rem;">Fecha Inicio:</label>
            <input type="date" id="filter_fecha_inicio" class="filter-select" value="{{ fecha_inicio }}">
        </div>
        
        <div>
            <label style="font-size: 0.875rem; font-weight: 600; color: #374151; margin-right: 0.5rem;">Fecha Fin:</label>
            <input type="date" id="filter_fecha_fin" class="filter-select" value="{{ fecha_fin }}">
        </div>
        
        <button class="btn-filter" onclick="aplicarFiltros()">
            <i class="fas fa-filter"></i> Aplicar
        </button>
    </div>
    
    <div class="timeline-container">
        {% for proyecto_id, proyecto_data in proyectos_con_planificaciones.items %}
            <div class="timeline-project">
                <div class="project-header">
                    <i class="fas fa-building"></i> {{ proyecto_data.proyecto.nombre }}
                </div>
                
                {% for plan in proyecto_data.planificaciones %}
                    <div class="timeline-track">
                        <div class="timeline-item">
                            <div class="timeline-label">
                                {{ plan.titulo }}
                                <br>
                                <span style="font-size: 0.75rem; color: #6b7280;">
                                    {{ plan.fecha_inicio|date:"d/m/Y" }}
                                    {% if plan.fecha_fin %}
                                        - {{ plan.fecha_fin|date:"d/m/Y" }}
                                    {% endif %}
                                </span>
                            </div>
                            <div class="timeline-bar-container">
                                <div class="timeline-bar {{ plan.estado }}" 
                                     style="width: 100%;"
                                     onclick="window.location.href='/bitacora/planificacion/{{ plan.id }}/'">
                                    {{ plan.get_estado_display }}
                                    {% if plan.hora_inicio %}
                                        - {{ plan.hora_inicio|time:"H:i" }}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% empty %}
            <div style="text-align: center; padding: 4rem; color: #6b7280;">
                <i class="fas fa-inbox" style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                <p>No hay planificaciones para mostrar</p>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function aplicarFiltros() {
        const proyecto = document.getElementById('filter_proyecto').value;
        const fecha_inicio = document.getElementById('filter_fecha_inicio').value;
        const fecha_fin = document.getElementById('filter_fecha_fin').value;
        
        let url = '{% url "bitacora_timeline" %}?';
        if (proyecto) url += `proyecto=${proyecto}&`;
        if (fecha_inicio) url += `fecha_inicio=${fecha_inicio}&`;
        if (fecha_fin) url += `fecha_fin=${fecha_fin}&`;
        
        window.location.href = url;
    }
</script>
{% endblock %}

