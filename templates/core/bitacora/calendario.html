{% extends 'base.html' %}
{% load static %}

{% block title %}Calendario - Bitácora{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.css" rel="stylesheet">
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
    
    * {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    
    body {
        background: #fafafa;
    }
    
    .hero-section {
        background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        color: white;
        padding: 3rem 0;
        margin: -2rem -2rem 2rem -2rem;
        position: relative;
        overflow: hidden;
    }
    
    .hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.15) 0%, transparent 50%);
    }
    
    .hero-content {
        position: relative;
        z-index: 1;
    }
    
    .hero-title {
        font-size: 2.5rem;
        font-weight: 900;
        margin-bottom: 0.5rem;
        letter-spacing: -0.02em;
    }
    
    .hero-subtitle {
        font-size: 1.125rem;
        opacity: 0.8;
    }
    
    .filters-section {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        align-items: center;
    }
    
    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .filter-label {
        font-size: 0.875rem;
        font-weight: 600;
        color: #374151;
    }
    
    .filter-select {
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        padding: 0.5rem 1rem;
        font-size: 0.9375rem;
        transition: all 0.2s;
    }
    
    .filter-select:focus {
        border-color: #6366f1;
        outline: none;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }
    
    .btn-filter {
        background: #6366f1;
        color: white;
        border: none;
        border-radius: 8px;
        padding: 0.5rem 1.5rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        margin-top: 1.5rem;
    }
    
    .btn-filter:hover {
        background: #4f46e5;
    }
    
    .calendar-container {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
    }
    
    #calendar {
        max-width: 100%;
        margin: 0 auto;
    }
</style>
{% endblock %}

{% block content %}
<div class="hero-section">
    <div class="container hero-content">
        <h1 class="hero-title">
            <i class="fas fa-calendar-alt me-3"></i>Calendario de Planificaciones
        </h1>
        <p class="hero-subtitle">Visualiza todas las planificaciones en calendario mensual y semanal</p>
    </div>
</div>

<div class="container">
    <div class="filters-section">
        <div class="filter-group">
            <label class="filter-label">Proyecto</label>
            <select id="filter_proyecto" class="filter-select">
                <option value="">Todos los proyectos</option>
                {% for proyecto in proyectos %}
                    <option value="{{ proyecto.id }}" {% if proyecto_seleccionado == proyecto.id|stringformat:"s" %}selected{% endif %}>
                        {{ proyecto.nombre }}
                    </option>
                {% endfor %}
            </select>
        </div>
        
        <div class="filter-group">
            <label class="filter-label">Estado</label>
            <select id="filter_estado" class="filter-select">
                <option value="">Todos los estados</option>
                <option value="programada" {% if estado_seleccionado == "programada" %}selected{% endif %}>Programada</option>
                <option value="en_progreso" {% if estado_seleccionado == "en_progreso" %}selected{% endif %}>En Progreso</option>
                <option value="completada" {% if estado_seleccionado == "completada" %}selected{% endif %}>Completada</option>
                <option value="cancelada" {% if estado_seleccionado == "cancelada" %}selected{% endif %}>Cancelada</option>
            </select>
        </div>
        
        <button class="btn-filter" onclick="aplicarFiltros()">
            <i class="fas fa-filter"></i> Aplicar Filtros
        </button>
    </div>
    
    <div class="calendar-container">
        <div id="calendar"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/locales/es.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const calendarEl = document.getElementById('calendar');
        const eventos = {{ eventos_calendario|safe }};
        
        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'es',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            buttonText: {
                today: 'Hoy',
                month: 'Mes',
                week: 'Semana',
                day: 'Día'
            },
            events: eventos,
            eventClick: function(info) {
                window.location.href = `/bitacora/planificacion/${info.event.id}/`;
            },
            height: 'auto',
            dayMaxEvents: 3,
        });
        
        calendar.render();
        window.calendar = calendar;
    });
    
    function aplicarFiltros() {
        const proyecto = document.getElementById('filter_proyecto').value;
        const estado = document.getElementById('filter_estado').value;
        
        let url = '{% url "bitacora_calendario" %}?';
        if (proyecto) url += `proyecto=${proyecto}&`;
        if (estado) url += `estado=${estado}&`;
        
        window.location.href = url;
    }
</script>
{% endblock %}

